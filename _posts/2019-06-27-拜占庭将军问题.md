---
title: 拜占庭将军
description: 最近在研究通信中信任问题，所以研究下理论基础
categories: 
 - 区块链
tags:
 - ctf-web
---

#  前言

看完了区块链的书籍后，发现拜占庭将军问题一直被提及，后来在看以太坊开发技术的时候，拜占庭将军问题又出现了了。所以准备收集资料，好好看看，记录在博客上，方便以后查找。

#  拜占庭将军问题

维基百科对“拜占庭将军问题”的解释是：

拜占庭将军问题（Byzantine Generals Problem），是由莱斯利·兰波特在其同名论文中提出的分布式对等网络通信容错问题。在分布式计算中，不同的计算机通过通讯交换信息达成共识而按照同一套协作策略行动。但有時候，系统中的成员计算机可能出错而发送错误的信息，用于传递信息的通讯网络也可能导致信息损坏，使得网络中不同的成员关于全体协作的策略得出不同结论，从而破坏系统一致性。拜占庭将军问题被认为是容错性问题中最难的问题类型之一。

我们来讲一个故事来帮助理解：拜占庭帝国是一个古老而强大的帝国，这次他们想攻打另一个强大的敌人，所以派出了10支军队想要包围敌人。并且这10支军队约定，互相依靠轻骑兵通信协商，在包围敌人之后同时进攻。那么问题来了，如果这其中有人叛变，传递错误的信息，那么怎么同时进攻来取得胜利呢？

还不够浅显？那我们再来说一个故事，大家都看过《哆啦A梦》吧，胖虎是个孩子王，但他其实很怕事，遇到比自己更强大的对手立刻就怂。所以，有一天，常常遭到胖虎欺负的哆啦A梦、大熊、静香、小夫一起开了一次小型的会议，决定联合起来去找胖虎谈判）。他们偷偷的给胖虎扔了一张小纸条，气势汹汹的约胖虎放学不走。下课铃响起，胖虎悠哉悠哉的等着谁找他麻烦，而其他四位小伙伴计划先各自回家，放下书包，再去集合。大熊刚到家，哆啦A梦突然说：“小夫一直是个胆小鬼，万一他不去怎么办？”大熊迟疑了，他想：“对啊，静香又是个女孩子，万一也不想去，我们两个去了一定会被胖虎揍一顿，我有点不想去了。”于是哆啦A梦和大雄在家里踌躇着，静香和小夫其实也在家里考虑着，都认为大熊胆小，也极可能不会去。就这样，胖虎等了一小时也不见其他人。

明白了吗？这就是拜占庭将军问题。这个问题的本质就是如何让众多完全平等的节点针对某一状态达成共识。

# 解决方案
在看区块链的书时，比特币提供了一种解决方式-PoW(proof of work)，即工作量证明，工作量证明系统的主要特征就是众多参与节点需要做一定难度的工作得出一个结果，谁先得出立即全网广播，其他节点很容易通过结果来检查出之前节点是不是做了相应的工作，一旦结果被证明正确，其他节点会把之前节点的结果添加到各自的账单中，为争取下一笔的交易记录做好计算的准备。

这个过程就像一位将军A在向其他的将军发起一个进攻提议一样，之后的将军看到将军A签过名的进攻提议书，而如果其他将军也打算进攻，则在将军A的消息后面跟上自己的签名信息：“进攻 + 将军B”，以此类推。当此类消息达到十个，他们必将一同进攻。

这时也会出现一种情况，将军A发出消息后，可能会有两个或多个将军同时跟上“进攻+签名”的消息，这时，各个节点会严格按照广播的精确时间进行排序，确保一条链的完整性。也有完全同时广播出来的情况，这时就是“分叉”，出现一个分开的两条链，之后，哪条链上添加的账本多（共识多），哪条就成为主链，另一条分叉链就此中断或被部分矿工认可继续添加（例如以太坊和以太坊经典）。
# 原理
工作量证明（PoW）其实相当于提高了做叛徒（发布虚假区块）的成本，在这个系统下，只有第一个完成证明的节点才能广播区块，竞争难度非常大，需要很高的算力，如果不成功的话算力就白白耗费了。如果有这样的算力作为诚实的节点，同样也可以获得很大的收益，这就不会有做叛徒的动机，整个系统也因此而更稳定。
